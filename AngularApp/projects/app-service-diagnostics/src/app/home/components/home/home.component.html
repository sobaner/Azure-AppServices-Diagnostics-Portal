<ng-container *ngIf="initializedPortalVersion === 'v3'&&showSwitchBanner">
  <div *ngIf="useLegacy" class="switch2new-context-text home-banner">
    <i class="fa fa-info-circle info-banner-icon"></i>
    We have recently launched the new version of {{homePageText.title}}.
    <a (click)="switchView()" tabindex="0" (keyup.enter)="switchView()" aria-label="switch to the new version">Click
      here to checkout the new version.</a>
  </div>
</ng-container>

<div *ngIf="useLegacy else newHomePage" class="home-container">
  <ng-container *ngTemplateOutlet="previewBanner"></ng-container>
  <div class="input-group input-group-lg search-input-group" (keyup.escape)="clearSearch()" role="search"
    *ngIf="!isAKSOnNationalCloud">
    <input tabindex="0" type="search" class="form-control" placeholder="{{searchPlaceHolder}}" [ngModel]="searchValue"
      (ngModelChange)="updateSearchValue($event)" (focus)="onSearchBoxFocus(event)" (focusout)="onSearchLostFocus()"
      aria-controls="search-results">
    <div class="input-group-btn" id="clear-search">
      <button class="btn btn-default" type="button" aria-label="Clear" title="Clear" tabindex="0"
        (click)="clearSearch()" (focus)="onFocusClear()">
        <i class="fa fa-close"></i>
      </button>
    </div>
  </div>
  <div role="status">
    <p *ngIf="inputAriaLabel">{{inputAriaLabel}}</p>
  </div>
  <div id="search-results" role="region" aria-live="polite">
    <ng-container *ngIf="searchBoxFocus">
      <search-results [searchValue]="searchValue" (resultCount)="onResultCount($event)" (keyup.escape)="clearSearch()">
      </search-results>
    </ng-container>
  </div>
  <div class="main-area">
    <h2>{{homePageText.title}}</h2>
    <p id="page-description">{{homePageText.description}}</p>
    <div *ngIf="categories && !useStaticAksText " class="category-container">
      <div *ngFor="let category of categories" style="display: inline-block;padding: 20px 40px 20px 0px">
        <category-tile [category]="category"></category-tile>
      </div>
    </div>
    <markdown ngPreserveWhitespaces *ngIf="useStaticAksText">
      ## Management
      Cannot stop, start, or edit my Kubernetes containers

      - <a href="https://docs.azure.cn/aks/troubleshooting"
        target="_blank">https://docs.azure.cn/aks/troubleshooting</a>
      - <a href="https://docs.azure.cn/aks/kubernetes-dashboard"
        target="_blank">https://docs.azure.cn/aks/kubernetes-dashboard</a>
      - <a href="https://docs.azure.cn/aks/scale-cluster" target="_blank">https://docs.azure.cn/aks/scale-cluster</a>
      - <a href="https://docs.azure.cn/aks/upgrade-cluster"
        target="_blank">https://docs.azure.cn/aks/upgrade-cluster</a>
      - <a href="https://docs.azure.cn/aks/configure-azure-cni"
        target="_blank">https://docs.azure.cn/aks/configure-azure-cni</a>
      - <a href="https://docs.azure.cn/aks/kube-advisor-tool"
        target="_blank">https://docs.azure.cn/aks/kube-advisor-tool</a>
      - <a href="https://stackoverflow.com/questions/tagged/azure-container-service"
        target="_blank">https://stackoverflow.com/questions/tagged/azure-container-service</a>

      ## Configuration and setup issues
      Cannot create Azure Kubernetes service container cluster

      - <a href="https://docs.microsoft.com/azure/aks/create-cluster"
        target="_blank">https://docs.microsoft.com/azure/aks/create-cluster</a>
      - <a href="https://docs.azure.cn/aks/scale-cluster" target="_blank">https://docs.azure.cn/aks/scale-cluster</a>
      - <a href="https://docs.azure.cn/aks/upgrade-cluster"
        target="_blank">https://docs.azure.cn/aks/upgrade-cluster</a>
      - <a href="https://docs.azure.cn/aks/azure-disks-dynamic-pv"
        target="_blank">https://docs.azure.cn/aks/azure-disks-dynamic-pv</a>
      - <a href="https://docs.azure.cn/aks/ssh" target="_blank">https://docs.azure.cn/aks/ssh</a>
      - <a href="https://docs.azure.cn/aks/concepts-identity"
        target="_blank">https://docs.azure.cn/aks/concepts-identity</a>
      - <a href="https://docs.azure.cn/aks/troubleshooting"
        target="_blank">https://docs.azure.cn/aks/troubleshooting</a>
      - <a href="https://docs.azure.cn/aks/kube-advisor-tool"
        target="_blank">https://docs.azure.cn/aks/kube-advisor-tool</a>
      - <a href="https://docs.azure.cn/aks/kubernetes-dashboard"
        target="_blank">https://docs.azure.cn/aks/kubernetes-dashboard</a>
      - <a href="https://stackoverflow.com/questions/tagged/azure-container-service"
        target="_blank">https://stackoverflow.com/questions/tagged/azure-container-service</a>

      ## Connectivity
      Cannot connect to my Azure Kubernetes service container
      - <a href="https://docs.azure.cn/aks/ssh" target="_blank">https://docs.azure.cn/aks/ssh</a>
      - <a href="https://docs.azure.cn/aks/Kubernetes-dashboard"
        target="_blank">https://docs.azure.cn/aks/Kubernetes-dashboard</a>
      - <a href="https://docs.azure.cn/aks/configure-azure-cni"
        target="_blank">https://docs.azure.cn/aks/configure-azure-cni</a>
      - <a
        href="https://stackoverflow.com/questions/49560394/new-aks-cluster-unreachable-via-network-including-dashboard"
        target="_blank">https://stackoverflow.com/questions/49560394/new-aks-cluster-unreachable-via-network-including-dashboard</a>
      - <a href="https://stackoverflow.com/questions/51531561/kubernetes-aks-unable-to-view-the-site"
        target="_blank">https://stackoverflow.com/questions/51531561/kubernetes-aks-unable-to-view-the-site</a>
      - <a href="https://docs.azure.cn/aks/troubleshooting"
        target="_blank">https://docs.azure.cn/aks/troubleshooting</a>
      - <a href="https://docs.azure.cn/aks/kube-advisor-tool"
        target="_blank">https://docs.azure.cn/aks/kube-advisor-tool</a>
      - <a href="https://stackoverflow.com/questions/tagged/azure-container-service"
        target="_blank">https://stackoverflow.com/questions/tagged/azure-container-service</a>

      ## Connectivity
      Certificate Management issue (SSH key)

      - <a href="https://docs.azure.cn/aks/ssh" target="_blank">https://docs.azure.cn/aks/ssh</a>
    </markdown>
    <div class="privacy-statement">
      <a href="https://azure.microsoft.com/support/legal/?amp%3Bclcid=0x9" target="_blank">Privacy</a>
    </div>
  </div>
</div>


<ng-template #newHomePage>
  <fab-command-bar tabindex="0" contentClass="fab-command-bar-class">
    <items>
      <fab-command-bar-item key="askGenie" text="Ask Genie" [iconProps]="{ iconName: 'ChatInviteFriend' }"
        (click)="openGeniePanel()" data-track-type="run"></fab-command-bar-item>
      <fab-command-bar-item *ngIf="showRiskSection" key="refresh1" text="Refresh" [iconProps]="{ iconName: 'Refresh' }"
        (click)="refreshPage()">
      </fab-command-bar-item>
      <fab-command-bar-item key="sendFeedback" text="Feedback" [iconProps]="{ iconName: 'Emoji2' }"
        (click)="openFeedbackPanel()"></fab-command-bar-item>
    </items>
  </fab-command-bar>
  <ng-container *ngTemplateOutlet="previewBanner"></ng-container>
  <risk-alerts-notification></risk-alerts-notification>

  <ng-container *ngIf="initializedPortalVersion === 'v3'&&showSwitchBanner">
    <div *ngIf="!useLegacy" class="switch2old-context-text home-banner">
      <i class="fa fa-info-circle info-banner-icon"></i>
      Welcome to the new {{homePageText.title}}.
      <a (click)="switchView()" class="old-version-link" tabindex="0" (keyup.enter)="switchView()"
        aria-label="switch to the old version">Click here to go back to the old version.</a>
    </div>
  </ng-container>

  <div class="home-main-area">
    <div class="home-title-container">
      <h2><span tabindex="0" id="homepage-title" class="blade-title">{{homePageText.title}}</span><span
          class="blade-description"> - {{homePageText.description}}
        </span>
      </h2>
      <div class="home-search">
        <fabric-search-results></fabric-search-results>
        <div class="home-search-text">Have questions? <a tabindex="0" (click)="openGeniePanel()"
            (keyup.enter)="openGeniePanel()">Ask Genie</a></div>
      </div>
    </div>


    <div *ngIf="showRiskSection" class="section-container">
      <h2 class="section-title">Risk alerts</h2>
      <div class="home-tiles">
        <ng-container *ngFor="let riskAlertConfig of riskAlertConfigs">
          <risk-tile [riskAlertConfig]="riskAlertConfig"></risk-tile>
        </ng-container>
      </div>
    </div>

    <div class="section-container">
      <h2 class="section-title">Troubleshooting categories</h2>
      <div *ngIf="categories" class="home-tiles">
        <div *ngFor="let category of categories" class="home-tile-wrapper">
          <category-tile-v4 [category]="category"></category-tile-v4>
        </div>
      </div>
    </div>

    <div class="section-container">
      <h2 *ngIf="!loadingQuickLinks && quickLinkFeatures.length > 0" class="section-title">Popular troubleshooting tools
      </h2>
      <div *ngIf="!loadingQuickLinks else loading">
        <div class="quick-link" *ngFor="let feature of quickLinkFeatures">
          <a tabindex="0" (click)="clickQuickLink(feature)" (keyup.enter)="clickQuickLink(feature)">{{feature.name}}</a>
        </div>
      </div>
    </div>

    <div class="privacy-statement">
      <a href="https://azure.microsoft.com/support/legal/?amp%3Bclcid=0x9" target="_blank">Privacy</a>
    </div>
  </div>
</ng-template>


<ng-template #loading>
  <div class="home-spinner">
    <fab-spinner [ariaLabel]="'Loading Quick Links'"></fab-spinner>
  </div>
</ng-template>

<ng-template #previewBanner>
  <ng-container *ngIf="enableABTesting && !showSwitchBanner">
    <div [ngStyle]="{'background-color': isPreview ? '#F0F6FF' : '#F9F3FC'}" class="home-banner">
      <i class="ib-purplerocket"></i>
      <i class="ib-info"></i>
      <span>{{abTestingBannerText}}, click&nbsp;</span>
      <a (click)="openSlotInNewTab($event)"
        [attr.aria-label]="isPreview ? 'Open old experience in new tab':'Open new experience in new tab'">here
        <img src="assets/img/redirect-link.svg" alt="" style="margin-bottom: 5px;">
      </a>
      <span>&nbsp;. This will open in a new tab.</span>
    </div>
  </ng-container>
</ng-template>

<risk-alerts-panel></risk-alerts-panel>